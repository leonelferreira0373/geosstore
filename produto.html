<!DOCTYPE html>
<html lang="pt-AO">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produto — GEOSSTORE</title>
    <meta name="description" content="Compre sneakers originais na GEOSSTORE. Envio para todo Angola.">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="SVG/GS-LOGO-SVG-2.svg" type="image/svg+xml">
    <link rel="stylesheet" href="styles.css">
    <style>
        .product-page {
            margin-top: var(--header-height);
        }

        .product-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 64px;
            padding: 48px 0 80px;
            align-items: start;
        }

        /* Gallery */
        .gallery {
            position: sticky;
            top: calc(var(--header-height) + 24px);
        }

        .gallery-main {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: var(--bg-light);
            margin-bottom: 12px;
        }

        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-main:hover img {
            transform: scale(1.05);
        }

        .gallery-thumbs {
            display: flex;
            gap: 8px;
        }

        .gallery-thumb {
            width: 72px;
            height: 72px;
            border-radius: var(--radius-sm);
            border: 2px solid transparent;
            overflow: hidden;
            cursor: pointer;
            background: var(--bg-light);
            transition: border-color var(--transition-fast);
        }

        .gallery-thumb.active {
            border-color: var(--black);
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Product Info */
        .product-brand {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .product-name {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 16px;
        }

        .product-price-wrap {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 24px;
        }

        .product-price {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .product-old-price {
            font-size: 1.1rem;
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .product-discount-tag {
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 999px;
            font-weight: 600;
        }

        .product-description {
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        /* Sizes */
        .size-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 32px;
        }

        .size-btn {
            min-width: 52px;
            height: 44px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            background: var(--white);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .size-btn:hover {
            border-color: var(--black);
        }

        .size-btn.active {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        /* Quantity */
        .qty-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .qty-selector {
            display: inline-flex;
            align-items: center;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
        }

        .qty-selector button {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background var(--transition-fast);
        }

        .qty-selector button:hover {
            background: var(--bg-subtle);
        }

        .qty-selector span {
            width: 40px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* CTA Buttons */
        .cta-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        .btn-buy-now {
            flex: 1;
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 16px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-buy-now:hover {
            background: #005bb5;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 113, 226, 0.3);
        }

        .btn-add-cart {
            flex: 1;
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 16px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add-cart:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        /* Meta Info */
        .product-meta {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 24px 0;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 32px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .meta-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        /* Related */
        .related-section {
            padding: 80px 0;
            border-top: 1px solid var(--border-light);
        }

        /* Loading */
        .product-loading {
            text-align: center;
            padding: 120px 24px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .product-layout {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .gallery {
                position: static;
            }

            .product-name {
                font-size: 1.5rem;
            }

            .cta-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>

    <!-- ═══ HEADER ═══ -->
    <header class="site-header" role="banner">
        <div class="header-inner">
            <a href="index.html" class="logo" aria-label="GEOSSTORE">
                <img src="SVG/GS-LOGO-SVG-2.svg" alt="GEOSSTORE Logo" width="40" height="40">
            </a>
            <nav class="nav-center" role="navigation" aria-label="Navegação">
                <a href="index.html" class="nav-link">Início</a>
                <a href="feed.html" class="nav-link">Loja</a>
                <a href="feed.html?cat=homem" class="nav-link">Homem</a>
                <a href="feed.html?cat=mulher" class="nav-link">Mulher</a>
                <a href="feed.html?cat=crianca" class="nav-link">Criança</a>
            </nav>
            <div class="header-actions">
                <button class="header-icon-btn" data-open-cart aria-label="Carrinho">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <path d="M16 10a4 4 0 01-8 0" />
                    </svg>
                    <span class="cart-count" style="display:none;">0</span>
                </button>
                <div class="hamburger" aria-label="Menu" role="button" tabindex="0">
                    <span></span><span></span><span></span>
                </div>
            </div>
        </div>
    </header>

    <nav class="mobile-nav" role="navigation" aria-label="Navegação móvel">
        <a href="index.html">Início</a>
        <a href="feed.html">Loja</a>
    </nav>

    <main class="product-page">
        <div class="container">

            <nav class="breadcrumb" aria-label="Breadcrumb">
                <a href="index.html">Início</a>
                <span class="separator">›</span>
                <a href="feed.html">Loja</a>
                <span class="separator">›</span>
                <span id="breadcrumb-product">Produto</span>
            </nav>

            <!-- Loading state -->
            <div class="product-loading" id="product-loading">
                <p>A carregar produto...</p>
            </div>

            <!-- Product content (hidden until loaded) -->
            <div class="product-layout" id="product-layout" style="display:none;">

                <!-- LEFT: GALLERY -->
                <div class="gallery fade-up">
                    <div class="gallery-main" id="gallery-main">
                        <img src="IMG/GS-LOGO-2.png" alt="" id="main-image">
                    </div>
                    <div class="gallery-thumbs" id="gallery-thumbs"></div>
                </div>

                <!-- RIGHT: INFO -->
                <div class="fade-up" style="animation-delay:0.15s;">
                    <div class="product-brand" id="prod-brand">—</div>
                    <h1 class="product-name" id="prod-name">—</h1>

                    <div class="product-price-wrap">
                        <span class="product-price" id="prod-price">—</span>
                        <span class="product-old-price" id="prod-old-price" style="display:none;"></span>
                        <span class="product-discount-tag" id="prod-discount" style="display:none;"></span>
                    </div>

                    <div class="product-description" id="prod-description"></div>

                    <!-- Size Selection -->
                    <div>
                        <span class="form-label" style="margin-bottom:10px;display:block;">Tamanho</span>
                        <div class="size-grid" id="size-grid"></div>
                    </div>

                    <!-- Quantity -->
                    <div class="qty-row">
                        <span class="form-label">Quantidade</span>
                        <div class="qty-selector">
                            <button id="qty-minus" aria-label="Diminuir">−</button>
                            <span id="qty-value">1</span>
                            <button id="qty-plus" aria-label="Aumentar">+</button>
                        </div>
                        <span class="text-sm text-muted" id="stock-info"></span>
                    </div>

                    <!-- CTA BUTTONS -->
                    <div class="cta-buttons">
                        <button class="btn-buy-now" id="buy-now-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                            </svg>
                            Comprar Agora
                        </button>
                        <button class="btn-add-cart" id="add-cart-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z" />
                                <line x1="3" y1="6" x2="21" y2="6" />
                                <path d="M16 10a4 4 0 01-8 0" />
                            </svg>
                            Adicionar ao Carrinho
                        </button>
                    </div>

                    <!-- Trust / Meta -->
                    <div class="product-meta">
                        <div class="meta-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7" />
                            </svg>
                            <span>Envio para todo Angola em 2–5 dias úteis</span>
                        </div>
                        <div class="meta-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                            </svg>
                            <span>100% Original — Garantia de autenticidade</span>
                        </div>
                        <div class="meta-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path
                                    d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z" />
                            </svg>
                            <span>Suporte via WhatsApp — Resposta rápida</span>
                        </div>
                    </div>

                    <!-- Category badge -->
                    <div id="prod-category-badge"></div>
                </div>
            </div>

            <!-- REVIEWS SECTION -->
            <section class="reviews-section" id="reviews-section"
                style="display:none; padding: 80px 0; border-top: 1px solid var(--border-light);">
                <div style="max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align:center; margin-bottom: 40px;">Avaliações de Clientes</h2>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 32px;">
                        <div>
                            <span style="font-size: 2rem; font-weight:700; margin-right: 8px;"
                                id="avg-rating">0.0</span>
                            <span id="avg-stars" style="color: #f59e0b;"></span>
                            <span class="text-sm text-muted" style="margin-left: 8px;">(<span
                                    id="total-reviews">0</span> avaliações)</span>
                        </div>
                        <button class="btn btn-primary btn-sm"
                            onclick="document.getElementById('review-form-container').style.display='block'; this.style.display='none';">Escrever
                            Avaliação</button>
                    </div>

                    <!-- Review Form -->
                    <div id="review-form-container"
                        style="display:none; background: var(--bg-subtle); padding: 24px; border-radius: var(--radius-md); margin-bottom: 40px;">
                        <h3 style="margin-bottom: 16px;">Sua Avaliação</h3>
                        <form id="review-form" onsubmit="submitReview(event)">
                            <div style="margin-bottom: 16px;">
                                <label class="form-label">Nome</label>
                                <input type="text" class="form-input" id="rev-name" required placeholder="Seu nome">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label class="form-label">Classificação</label>
                                <input type="hidden" id="rev-rating" value="5">
                                <div id="star-rating-input"
                                    style="display:flex;gap:4px;cursor:pointer;font-size:1.8rem;">
                                    <span class="star-btn" data-value="1"
                                        style="color:#f59e0b;transition:transform 0.15s;">★</span>
                                    <span class="star-btn" data-value="2"
                                        style="color:#f59e0b;transition:transform 0.15s;">★</span>
                                    <span class="star-btn" data-value="3"
                                        style="color:#f59e0b;transition:transform 0.15s;">★</span>
                                    <span class="star-btn" data-value="4"
                                        style="color:#f59e0b;transition:transform 0.15s;">★</span>
                                    <span class="star-btn" data-value="5"
                                        style="color:#f59e0b;transition:transform 0.15s;">★</span>
                                </div>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label class="form-label">Comentário</label>
                                <textarea class="form-input" id="rev-comment" rows="4"
                                    placeholder="Conte-nos o que achou do produto..."></textarea>
                            </div>
                            <div style="display:flex; gap: 12px; justify-content: flex-end;">
                                <button type="button" class="btn btn-ghost"
                                    onclick="document.getElementById('review-form-container').style.display='none'; document.querySelector('.reviews-section .btn-primary').style.display='inline-flex';">Cancelar</button>
                                <button type="submit" class="btn btn-black">Submeter</button>
                            </div>
                        </form>
                    </div>

                    <!-- Review List -->
                    <div id="reviews-list" style="display:flex; flex-direction:column; gap: 24px;"></div>
                </div>
            </section>

            <!-- RELATED PRODUCTS -->
            <section class="related-section" id="related-section" style="display:none;">
                <h2 style="text-align:center;margin-bottom:40px;">Também Vai Gostar</h2>
                <div class="product-grid stagger-children" id="related-products"></div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer" role="contentinfo">
        <div class="container">
            <div class="footer-bottom" style="border-top:none;padding-top:0;">
                <p>&copy; <span class="dynamic-year">2026</span> GEOSSTORE. Todos os direitos reservados.</p>
                <div class="footer-social">
                    <a href="https://www.instagram.com/geosstore_/" target="_blank" rel="noopener"
                        aria-label="Instagram">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5" />
                            <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z" />
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Drawer -->
    <div class="cart-overlay" aria-hidden="true"></div>
    <aside class="cart-drawer" role="dialog" aria-label="Carrinho">
        <div class="cart-drawer-header">
            <h3>Carrinho</h3>
            <button class="cart-close-btn" data-close-cart aria-label="Fechar"><svg width="20" height="20"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg></button>
        </div>
        <div class="cart-drawer-body"></div>
        <div class="cart-drawer-footer"></div>
    </aside>

    <div class="toast-container" aria-live="polite"></div>

    <script src="app.js"></script>
    <script>
        let productData = null;
        let selectedSize = '';
        let qty = 1;

        // ── Load Product ──
        async function loadProduct() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            if (!id) {
                document.getElementById('product-loading').innerHTML = '<p>Produto não encontrado. <a href="feed.html" style="color:var(--accent);">Voltar à loja</a></p>';
                return;
            }

            try {
                productData = await GeoAPI.get(`/products/${id}`);
                renderProduct(productData);
                loadRelatedProducts(productData.category, productData.id);
                loadReviews(productData.id);
            } catch (err) {
                console.error('Error loading product:', err);
                document.getElementById('product-loading').innerHTML = '<p>Não foi possível carregar o produto. <a href="feed.html" style="color:var(--accent);">Voltar à loja</a></p>';
            }
        }

        // ── Reviews Logic ──
        async function loadReviews(productId) {
            try {
                // To adapt to the generic logic, we'll fetch all reviews and filter or preferably server-side filter
                // Our backend actually returns all reviews ordered by date right now. For now, filter local:
                const allReviews = await GeoAPI.get('/reviews');
                const productReviews = allReviews.filter(r => r.product_id === productId);

                document.getElementById('reviews-section').style.display = 'block';
                document.getElementById('total-reviews').textContent = productReviews.length;

                if (productReviews.length > 0) {
                    const avg = (productReviews.reduce((sum, r) => sum + r.rating, 0) / productReviews.length).toFixed(1);
                    document.getElementById('avg-rating').textContent = avg;
                    document.getElementById('avg-stars').innerHTML = '★'.repeat(Math.round(avg)) + '☆'.repeat(5 - Math.round(avg));

                    document.getElementById('reviews-list').innerHTML = productReviews.map(r => `
                        <div style="background: var(--white); border: 1px solid var(--border-light); padding: 24px; border-radius: var(--radius-sm);">
                            <div style="display:flex; justify-content:space-between; margin-bottom: 12px;">
                                <strong style="font-size:1.1rem;">${r.customer_name}</strong>
                                <span style="color: #f59e0b;">${'★'.repeat(r.rating) + '☆'.repeat(5 - r.rating)}</span>
                            </div>
                            <p style="color: var(--text-secondary); line-height:1.6; font-size: 0.95rem;">${r.comment || 'Nenhum comentário.'}</p>
                            <div style="margin-top: 16px; font-size: 0.8rem; color: var(--text-muted);">
                                ${new Date(r.created_at).toLocaleDateString()}
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('reviews-list').innerHTML = '<p class="text-muted">Ainda não há avaliações para este produto. Seja o primeiro!</p>';
                }
            } catch (err) {
                console.error('Error fetching reviews:', err);
            }
        }

        async function submitReview(e) {
            e.preventDefault();
            if (!productData) return;

            const name = document.getElementById('rev-name').value;
            const rating = parseInt(document.getElementById('rev-rating').value);
            const comment = document.getElementById('rev-comment').value;

            try {
                await GeoAPI.post('/reviews', { customer_name: name, rating, comment, product_id: productData.id });
                GeoToast.show('Avaliação submetida com sucesso!', 'success');
                e.target.reset();
                document.getElementById('review-form-container').style.display = 'none';
                document.querySelector('.reviews-section .btn-primary').style.display = 'inline-flex';
                loadReviews(productData.id);
            } catch (err) {
                GeoToast.show('Erro ao submeter avaliação.', 'error');
            }
        }

        // ── Render Product ──
        function renderProduct(p) {
            document.title = `${p.name} — GEOSSTORE`;
            document.querySelector('meta[name="description"]').content = `${p.name} por ${p.brand}. Compre na GEOSSTORE com envio para todo Angola.`;

            document.getElementById('breadcrumb-product').textContent = p.name;
            document.getElementById('prod-brand').textContent = p.brand;
            document.getElementById('prod-name').textContent = p.name;
            document.getElementById('prod-price').textContent = GeoUtils.formatPrice(p.price);
            document.getElementById('prod-description').textContent = p.description || '';

            // Main image
            const mainImg = document.getElementById('main-image');
            mainImg.src = p.image_url || 'IMG/GS-LOGO-2.png';
            mainImg.alt = p.name;

            // Old price / discount
            if (p.old_price && p.old_price > p.price) {
                document.getElementById('prod-old-price').textContent = GeoUtils.formatPrice(p.old_price);
                document.getElementById('prod-old-price').style.display = '';
                const discount = Math.round((1 - p.price / p.old_price) * 100);
                document.getElementById('prod-discount').textContent = `-${discount}%`;
                document.getElementById('prod-discount').style.display = '';
            }

            // Sizes
            const sizeGrid = document.getElementById('size-grid');
            if (p.sizes) {
                const sizesArr = p.sizes.split(',').map(s => s.trim());
                sizeGrid.innerHTML = sizesArr.map(s => `
          <button class="size-btn" data-size="${s}" onclick="selectSize('${s}', this)">${s}</button>
        `).join('');
            } else {
                sizeGrid.innerHTML = '<span class="text-sm text-muted">Tamanho único</span>';
            }

            // Stock
            if (p.stock > 0) {
                document.getElementById('stock-info').textContent = `${p.stock} em stock`;
            } else {
                document.getElementById('stock-info').textContent = 'Esgotado';
                document.getElementById('stock-info').style.color = 'var(--danger)';
            }

            // Category badge
            const catMap = { homem: 'Homem', mulher: 'Mulher', crianca: 'Criança', unisexo: 'Unisexo' };
            document.getElementById('prod-category-badge').innerHTML = `
        <a href="feed.html?cat=${p.category}" class="badge badge-outline" style="margin-top:16px;">${catMap[p.category] || p.category}</a>
      `;

            // Show layout, hide loading
            document.getElementById('product-loading').style.display = 'none';
            document.getElementById('product-layout').style.display = '';
        }

        // ── Size Selection ──
        function selectSize(size, el) {
            selectedSize = size;
            document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        // ── Quantity ──
        document.getElementById('qty-minus')?.addEventListener('click', () => {
            if (qty > 1) {
                qty--;
                document.getElementById('qty-value').textContent = qty;
            }
        });
        document.getElementById('qty-plus')?.addEventListener('click', () => {
            qty++;
            document.getElementById('qty-value').textContent = qty;
        });

        // ── Add to Cart ──
        document.getElementById('add-cart-btn')?.addEventListener('click', () => {
            if (!productData) return;
            if (productData.sizes && !selectedSize) {
                GeoToast.show('Por favor, selecione um tamanho.', 'error');
                return;
            }
            GeoCart.addItem({
                id: productData.id,
                name: productData.name,
                brand: productData.brand,
                price: productData.price,
                image: productData.image_url || '',
                size: selectedSize,
                qty: qty
            });
        });

        // ── Buy Now ──
        document.getElementById('buy-now-btn')?.addEventListener('click', () => {
            if (!productData) return;
            if (productData.sizes && !selectedSize) {
                GeoToast.show('Por favor, selecione um tamanho.', 'error');
                return;
            }
            GeoCart.addItem({
                id: productData.id,
                name: productData.name,
                brand: productData.brand,
                price: productData.price,
                image: productData.image_url || '',
                size: selectedSize,
                qty: qty
            });
            // Go straight to checkout
            window.location.href = 'checkout.html';
        });

        // ── Load Related Products ──
        async function loadRelatedProducts(category, excludeId) {
            try {
                const data = await GeoAPI.get(`/products?category=${category}&limit=4`);
                const related = data.products.filter(p => p.id !== excludeId).slice(0, 4);
                if (related.length > 0) {
                    document.getElementById('related-products').innerHTML = related.map(p => GeoUtils.renderProductCard(p)).join('');
                    document.getElementById('related-section').style.display = '';
                    GeoScroll.init();
                }
            } catch (err) {
                console.error('Error loading related:', err);
            }
        }

        // ── Interactive Star Rating ──
        function updateStarDisplay(rating) {
            document.querySelectorAll('#star-rating-input .star-btn').forEach(star => {
                const val = parseInt(star.dataset.value);
                star.textContent = val <= rating ? '★' : '☆';
                star.style.color = val <= rating ? '#f59e0b' : '#d1d5db';
                star.style.transform = val <= rating ? 'scale(1.15)' : 'scale(1)';
            });
        }

        document.getElementById('star-rating-input')?.addEventListener('click', (e) => {
            const star = e.target.closest('.star-btn');
            if (!star) return;
            const rating = parseInt(star.dataset.value);
            document.getElementById('rev-rating').value = rating;
            updateStarDisplay(rating);
        });

        document.getElementById('star-rating-input')?.addEventListener('mouseover', (e) => {
            const star = e.target.closest('.star-btn');
            if (!star) return;
            const hoverVal = parseInt(star.dataset.value);
            document.querySelectorAll('#star-rating-input .star-btn').forEach(s => {
                const val = parseInt(s.dataset.value);
                s.textContent = val <= hoverVal ? '★' : '☆';
                s.style.color = val <= hoverVal ? '#f59e0b' : '#d1d5db';
                s.style.transform = val <= hoverVal ? 'scale(1.2)' : 'scale(1)';
            });
        });

        document.getElementById('star-rating-input')?.addEventListener('mouseleave', () => {
            const current = parseInt(document.getElementById('rev-rating').value) || 5;
            updateStarDisplay(current);
        });

        // Init stars at 5
        updateStarDisplay(5);

        // Init
        loadProduct();
    </script>

</body>

</html>